{% extends 'base.html.twig' %}
{% block title %}{{ figure.title }}{% endblock %}
{% block body %}

<!-- FOND D'ÉCRAN -->
<v-card flat outlined style="z-index:-1;position:fixed;top:0;left:0;height:100%;width:100%;border:none;">

    <v-img src="/backgrounds/background1.jpg" style="height:100%;width:100%;"></v-img>

</v-card>

<!-- TITRE ET IMAGE EN UNE -->
<v-container mt-3 mb-n2>

    <v-row
    align="center"
    justify="center"
    >

        <v-col class="white--text text-center" cols="12" >

            <p class="post-title">{{ figure.title }}</p>

                <br />

                <v-img
                :aspect-ratio="16/9"
                src="{{ figure.image }}"
                alt="{{ figure.title }}"
                title="{{ figure.title }}"
                >
                </v-img>

        </v-col>

    </v-row>

</v-container>

<!-- BOUTONS POUR AFFICHER LES MÉDIAS EN VERSION SMARTHPONE -->
<v-container class="control-medias-container text-center">

    <v-btn
    class="control-medias"
    color="primary"
    dark
    style="font-weight:bold;"
    >
    IMAGES ET VIDÉOS
    </v-btn>

    <v-btn
    class="control-medias-2"
    color="primary"
    dark
    style="font-weight:bold;"
    >
    FERMER L'ONGLET
    </v-btn>

</v-container>

<!-- GRILLE D'IMAGES ET DE VIDÉOS ASSOCIÉES -->
<v-container class="medias-grid">

    <v-layout row wrap>

        <v-col cols="12">
    
            <v-row>

                {% for screen in figure.screens %}

                {% if not (screen.thumbnail starts with 'http') %}

                {% if screen.thumbnail is not null %}

                <!-- Modal Screen VIDEOS -->
                <v-col
                cols="12"
                md="2"
                >
                    
                    <card class="post-details">

                        <div class="post-details-content">

                            <v-img src="https://img.youtube.com/vi/{{ screen.thumbnail }}/hqdefault.jpg" class="flip-image-bis" alt="Illustration" title="Illustration"></v-img>

                        </div>

                        <!-- TWIG : " loop.index " renvoie l'index de l'itération actuelle dans la boucle (https://twig.symfony.com/doc/2.x/tags/for.html#iterating-over-keys-and-values) -->
                        <div class="text-center">

                            <v-dialog
                            v-model="modal_screen_{{ loop.index }}"
                            transition="dialog-bottom-transition"
                            width="600"
                            >   

                                <template v-slot:activator="{ on, attrs }">

                                    <v-btn
                                    style="margin-top:-40px;"
                                    fab
                                    depressed
                                    color="primary"
                                    dark
                                    small
                                    v-bind="attrs"
                                    v-on="on"
                                    >
                                    <i class="fas fa-play"></i>
                                    </v-btn>

                                </template>

                                <v-card width="600" height="400">

                                    <iframe width="100%" height="400px" src="https://www.youtube.com/embed/{{ screen.thumbnail }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

                                </v-card>

                            </v-dialog>

                        </div>
                      
                    </card>
                    
                </v-col>

                {% endif %}

                {% else %}

                {% if screen.thumbnail is not null %}

                <!-- Modal Screen IMAGES -->
                <v-col
                cols="12"
                md="2"
                >
                    
                    <card class="post-details">

                        <div class="post-details-content">

                            <v-img src="{{ screen.thumbnail }}" class="flip-image-bis" alt="Illustration" title="Illustration"></v-img>

                        </div>

                        <!-- TWIG : loop.index renvoie lindex de l'itération actuelle dans la boucle (https://twig.symfony.com/doc/2.x/tags/for.html#iterating-over-keys-and-values) -->
                        <div class="text-center">

                            <v-dialog
                            v-model="modal_screen_{{ loop.index }}"
                            transition="dialog-bottom-transition"
                            width="600"
                            >   

                                <template v-slot:activator="{ on, attrs }">
                                    <v-btn
                                    style="margin-top:-40px;"
                                    fab
                                    depressed
                                    color="primary"
                                    dark
                                    small
                                    v-bind="attrs"
                                    v-on="on"
                                    >
                                    <i class="fas fa-plus"></i>
                                    </v-btn>

                                </template>

                                <v-card width="600" height="auto">

                                    <v-img src="{{ screen.thumbnail }}" class="flip-image-bis" alt="Illustration" title="Illustration"></v-img>

                                </v-card>

                            </v-dialog>

                        </div>
                      
                    </card>
                    
                </v-col>

                {% endif %}

                {% endif %}

                {% endfor %}

            </v-row>

        </v-col>

    </v-layout>
    
</v-container>

<!-- CONTENU TEXTE ET DATES -->
<v-container mt-n3>

      <v-layout row wrap>

        <v-col cols="12">

            <v-card flat class="pa-5" color="rgba(255,255,255,1)" style="border-radius:0px;">

                <v-card-text
                class="pt-6"
                style="position: relative;"
                >

                    <p class="post-font-size mb-12" style="color:#444444;">{{ figure.content | raw }}</p>

                    <p class="font-weight-light grey--text body-2 mb-2">Publié le {{ figure.createdAt | date('d/m/Y') }} à {{ figure.createdAt | date ('H:i') }} &bull; Catégorie {{ figure.classification.title }}</p>

                    <!-- Lien Modifier l'article uniquement visible pour l'adminsitrateur du site -->
                    {#
                    {% if app.user.id is defined and app.user.id == '1' %}
                    #}
                    
                    <!-- Lien Modifier l'article uniquement visible pour un membre du site -->
                    {% if app.user %}

                        <a href="{{ path('blog_edit', {'id': figure.id}) }}">
                        <p class="text-right body-2">
                            <i class="fas fa-pen"></i>&nbsp;&nbsp;MODIFIER CET ARTICLE
                        </p>
                        </a>
                    {% endif %}

                </v-card-text>

            </v-card>

        </v-col>

    </v-layout>

</v-container>

<!-- COMMENTAIRES -->
{% if app.user %}

<v-container fluid class="mt-n3">

    <v-row>    

        <v-col cols="12">

            <v-card flat class="pa-5" color="rgba(255,255,255,0)" outlined>

                <v-row>

                    <v-col cols="12" md="4"></v-col>

                    <v-col
                    cols="12"
                    md="4"
                    >

                        <v-card class="pa-5" outlined style="border-color:rgb(255,255,255,0);" color="rgba(255,255,255,0.2)">

                        {{ form_start(formMention) }}

                        {{ form_row(formMention.author, {'label': ' ', 'attr': {'placeholder': 'Pseudo'}}) }}

                        {{ form_row(formMention.content, {'label': ' ', 'attr': {'placeholder': 'Commentaire'}}) }}

                        <button type="submit" class="edit-post-button" style="background-color:teal !important;color:white !important;margin-top:10px;margin-left:10px;float:right;">
                        Publier
                        </button>

                        {{ form_end(formMention) }}  

                        </v-card>

                    </v-col>       

                    <v-col cols="12" md="4"></v-col>

                </v-row>   

            </v-card>

        </v-col>

    </v-row>

</v-container>

{% else %}

<v-container>

    <v-layout row wrap>

        <v-col cols="12">

            <v-card color="rgba(255,255,255,0)" outlined> 

                <p class="text-center white--text">Connectez-vous pour commenter cet article</p> 

            </v-card>

        </v-col>  

    </v-layout>
    
</v-container>

{% endif %}

{% if figure.mentions is empty %}    
{% else %}

<v-card color="rgb(240, 240, 240, 0)" class="pa-5 mt-3" outlined> 

    {% if figure.mentions | length == '1' %}

         <p class="white--text">&nbsp;&nbsp;&nbsp;&nbsp;{{ figure.mentions | length }} commentaire</p>   

    {% endif %} 
                    
    {% if figure.mentions | length > '1' %}

        <p class="white--text">&nbsp;&nbsp;&nbsp;&nbsp;{{ figure.mentions | length }} commentaires</p>             

    {% endif %} 

    <v-container fluid>

        <v-row>

            {% for mention in figure.mentions %}

                <v-col
                class="comments-loop"
                cols="12"
                md="3"
                >

                    <v-card class="pa-2">   

                        <v-card-text>

                            <p class="body-1" style="color:dimgrey;">Par {{ mention.author }} le {{ mention.createdAt | date('d/m/Y à H:i') }}</p>
                            <p class="body-1" style="color:dimgrey;">{{ mention.content | striptags | raw }}</p> 
                            <p>{{ mention.user.avatar }}</p>
                            <img src="{{ asset('uploads/avatars/' ~ '/' ~ mention.user.avatar) }}">
                           


                        </v-card-text>

                    </v-card> 

                </v-col>

            {% endfor %}

        </v-row>

    </v-container>

</v-card>

{% endif %}


<!-- MODAL 2 & 3 : MODAL IN MODAL EXAMPLE -->
<!-- Modal 2 -->
<!--<div class="text-center">
    <v-dialog
      v-model="modal_2"
      transition="dialog-top-transition"
      width="500"
    >
      <template v-slot:activator="{ on, attrs }">
        <v-btn
          color="red lighten-2"
          dark
          v-bind="attrs"
          v-on="on"
        >
          Click Me
        </v-btn>
      </template>

      <v-card>
        <v-card-title class="headline grey lighten-2">
          Privacy Policy
        </v-card-title>

        <v-card-text>

            <v-dialog
                v-model="modal_3"
                transition="dialog-top-transition"
                width="500"
                >
                <template v-slot:activator="{ on, attrs }">
                    <v-btn
                    color="red lighten-2"
                    dark
                    v-bind="attrs"
                    v-on="on"
                    >
                    Click Me
                    </v-btn>
                </template>

                <v-card>
                    <v-card-title class="headline grey lighten-2">
                    Privacy Policy
                    </v-card-title>

                    <v-card-text>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                    </v-card-text>

                    <v-divider></v-divider>

                    <v-card-actions>
                    <v-spacer></v-spacer>
                    <v-btn
                        color="primary"
                        text
                        @click="modal_3 = false"
                    >
                        I accept
                    </v-btn>
                    </v-card-actions>
                </v-card>
            </v-dialog>

        </v-card-text>

        <v-divider></v-divider>

        <v-card-actions>
          <v-spacer></v-spacer>
          <v-btn
            color="primary"
            text
            @click="modal_2 = false"
          >
            I accept
          </v-btn>
        </v-card-actions>
      </v-card>
    </v-dialog>
</div>-->

{% endblock %}

{% block javascripts %}

<!-- ***** Script de pagination jQuery ***** -->
<script src="/js/paginate.js"></script>

{% endblock %}